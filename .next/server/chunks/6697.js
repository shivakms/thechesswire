"use strict";exports.id=6697,exports.ids=[6697],exports.modules={12381:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(55648).A)("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]])},16374:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(55648).A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},29754:(a,b,c)=>{function d(a,b,c,e){var f=Error.call(this,a);return Object.setPrototypeOf&&Object.setPrototypeOf(f,d.prototype),f.expected=b,f.found=c,f.location=e,f.name="SyntaxError",f}function e(a,b,c){return(c=c||" ",a.length>b)?a:(b-=a.length,a+(c+=c.repeat(b)).slice(0,b))}function f(a,b){return(a<<b|a>>64n-b)&0xffffffffffffffffn}function g(a,b){return a*b&0xffffffffffffffffn}c.d(b,{d$:()=>I}),!function(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}(d,Error),d.prototype.format=function(a){var b="Error: "+this.message;if(this.location){var c,d=null;for(c=0;c<a.length;c++)if(a[c].source===this.location.source){d=a[c].text.split(/\r\n|\n|\r/g);break}var f=this.location.start,g=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(f):f,h=this.location.source+":"+g.line+":"+g.column;if(d){var i=this.location.end,j=e("",g.line.toString().length," "),k=d[f.line-1],l=(f.line===i.line?i.column:k.length+1)-f.column||1;b+="\n --\x3e "+h+"\n"+j+" |\n"+g.line+" | "+k+"\n"+j+" | "+e("",f.column-1," ")+e("",l,"^")}else b+="\n at "+h}return b},d.buildMessage=function(a,b){var c={literal:function(a){return'"'+e(a.text)+'"'},class:function(a){var b=a.parts.map(function(a){return Array.isArray(a)?f(a[0])+"-"+f(a[1]):f(a)});return"["+(a.inverted?"^":"")+b.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(a){return a.description}};function d(a){return a.charCodeAt(0).toString(16).toUpperCase()}function e(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+d(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+d(a)})}function f(a){return a.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+d(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+d(a)})}function g(a){return c[a.type](a)}return"Expected "+function(a){var b,c,d=a.map(g);if(d.sort(),d.length>0){for(b=1,c=1;b<d.length;b++)d[b-1]!==d[b]&&(d[c]=d[b],c++);d.length=c}switch(d.length){case 1:return d[0];case 2:return d[0]+" or "+d[1];default:return d.slice(0,-1).join(", ")+", or "+d[d.length-1]}}(a)+" but "+(b?'"'+e(b)+'"':"end of input")+" found."};let h=function(a){return function(){let b=BigInt(0xffffffffffffffffn&a),c=BigInt(a>>64n&0xffffffffffffffffn),d=g(f(g(b,5n),7n),9n);return c^=b,b=(f(b,24n)^c^c<<16n)&0xffffffffffffffffn,a=(c=f(c,37n))<<64n|b,d}}(0xa187eb39cdcaed8f31c4b365b102e01en),i=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>h()))),j=Array.from({length:8},()=>h()),k=Array.from({length:16},()=>h()),l=h(),m="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class n{color;from;to;piece;captured;promotion;flags;san;lan;before;after;constructor(a,b){let{color:c,piece:d,from:e,to:f,flags:g,captured:h,promotion:i}=b,j=D(e),k=D(f);for(let e in this.color=c,this.piece=d,this.from=j,this.to=k,this.san=a._moveToSan(b,a._moves({legal:!0})),this.lan=j+k,this.before=a.fen(),a._makeMove(b),this.after=a.fen(),a._undoMove(),this.flags="",p)p[e]&g&&(this.flags+=o[e]);h&&(this.captured=h),i&&(this.promotion=i,this.lan+=i)}isCapture(){return this.flags.indexOf(o.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(o.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(o.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(o.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(o.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(o.BIG_PAWN)>-1}}let o={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},p={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},q={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},r={...q,WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},s={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},t={b:[16,32,17,15],w:[-16,-32,-17,-15]},u={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},v=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],w=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],x={p:1,n:2,b:4,r:8,q:16,k:32},y=["n","b","r","q"],z={k:p.KSIDE_CASTLE,q:p.QSIDE_CASTLE},A={w:[{square:s.a1,flag:p.QSIDE_CASTLE},{square:s.h1,flag:p.KSIDE_CASTLE}],b:[{square:s.a8,flag:p.QSIDE_CASTLE},{square:s.h8,flag:p.KSIDE_CASTLE}]},B={b:1,w:6};function C(a){return -1!=="0123456789".indexOf(a)}function D(a){let b=15&a,c=a>>4;return"abcdefgh".substring(b,b+1)+"87654321".substring(c,c+1)}function E(a){return"w"===a?"b":"w"}function F(a,b,c,d,e,f,g=p.NORMAL){let h=d>>4;if("p"===e&&(7===h||0===h))for(let h=0;h<y.length;h++){let i=y[h];a.push({color:b,from:c,to:d,piece:e,captured:f,promotion:i,flags:g|p.PROMOTION})}else a.push({color:b,from:c,to:d,piece:e,captured:f,flags:g})}function G(a){let b=a.charAt(0);if(b>="a"&&b<="h"){if(a.match(/[a-h]\d.*[a-h]\d/))return;return"p"}return"o"===(b=b.toLowerCase())?"k":b}function H(a){return a.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class I{_board=Array(128);_turn="w";_header={};_kings={w:-1,b:-1};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_hash=0n;_positionCount=new Map;constructor(a=m,{skipValidation:b=!1}={}){this.load(a,{skipValidation:b})}clear({preserveHeaders:a=!1}={}){this._board=Array(128),this._kings={w:-1,b:-1},this._turn="w",this._castling={w:0,b:0},this._epSquare=-1,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=a?this._header:{...r},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(a,{skipValidation:b=!1,preserveHeaders:c=!1}={}){let d=a.split(/\s+/);if(d.length>=2&&d.length<6&&(a=d.concat(["-","-","0","1"].slice(-(6-d.length))).join(" ")),d=a.split(/\s+/),!b){let{ok:b,error:c}=function(a){let b=a.split(/\s+/);if(6!==b.length)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};let c=parseInt(b[5],10);if(isNaN(c)||c<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};let d=parseInt(b[4],10);if(isNaN(d)||d<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(b[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(b[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(b[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};let e=b[0].split("/");if(8!==e.length)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let a=0;a<e.length;a++){let b=0,c=!1;for(let d=0;d<e[a].length;d++)if(C(e[a][d])){if(c)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};b+=parseInt(e[a][d],10),c=!0}else{if(!/^[prnbqkPRNBQK]$/.test(e[a][d]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};b+=1,c=!1}if(8!==b)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if("3"==b[3][1]&&"w"==b[1]||"6"==b[3][1]&&"b"==b[1])return{ok:!1,error:"Invalid FEN: illegal en-passant square"};for(let{color:a,regex:c}of[{color:"white",regex:/K/g},{color:"black",regex:/k/g}]){if(!c.test(b[0]))return{ok:!1,error:`Invalid FEN: missing ${a} king`};if((b[0].match(c)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${a} kings`}}return Array.from(e[0]+e[7]).some(a=>"P"===a.toUpperCase())?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}(a);if(!b)throw Error(c)}let e=d[0],f=0;this.clear({preserveHeaders:c});for(let a=0;a<e.length;a++){let b=e.charAt(a);if("/"===b)f+=8;else if(C(b))f+=parseInt(b,10);else{let a=b<"a"?"w":"b";this._put({type:b.toLowerCase(),color:a},D(f)),f++}}this._turn=d[1],d[2].indexOf("K")>-1&&(this._castling.w|=p.KSIDE_CASTLE),d[2].indexOf("Q")>-1&&(this._castling.w|=p.QSIDE_CASTLE),d[2].indexOf("k")>-1&&(this._castling.b|=p.KSIDE_CASTLE),d[2].indexOf("q")>-1&&(this._castling.b|=p.QSIDE_CASTLE),this._epSquare="-"===d[3]?-1:s[d[3]],this._halfMoves=parseInt(d[4],10),this._moveNumber=parseInt(d[5],10),this._hash=this._computeHash(),this._updateSetup(a),this._incPositionCount()}fen({forceEnpassantSquare:a=!1}={}){let b=0,c="";for(let a=s.a8;a<=s.h1;a++){if(this._board[a]){b>0&&(c+=b,b=0);let{color:d,type:e}=this._board[a];c+="w"===d?e.toUpperCase():e.toLowerCase()}else b++;a+1&136&&(b>0&&(c+=b),a!==s.h1&&(c+="/"),b=0,a+=8)}let d="";this._castling.w&p.KSIDE_CASTLE&&(d+="K"),this._castling.w&p.QSIDE_CASTLE&&(d+="Q"),this._castling.b&p.KSIDE_CASTLE&&(d+="k"),this._castling.b&p.QSIDE_CASTLE&&(d+="q"),d=d||"-";let e="-";if(-1!==this._epSquare)if(a)e=D(this._epSquare);else{let a=this._epSquare+("w"===this._turn?16:-16);for(let b of[a+1,a-1]){if(136&b)continue;let a=this._turn;if(this._board[b]?.color===a&&this._board[b]?.type==="p"){this._makeMove({color:a,from:b,to:this._epSquare,piece:"p",captured:"p",flags:p.EP_CAPTURE});let c=!this._isKingAttacked(a);if(this._undoMove(),c){e=D(this._epSquare);break}}}}return[c,this._turn,d,e,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(a){if(!this._board[a])return 0n;let{color:b,type:c}=this._board[a];return i[({w:0,b:1})[b]][({p:0,n:1,b:2,r:3,q:4,k:5})[c]][a]}_epKey(){return -1===this._epSquare?0n:j[7&this._epSquare]}_castlingKey(){return k[this._castling.w>>5|this._castling.b>>3]}_computeHash(){let a=0n;for(let b=s.a8;b<=s.h1;b++){if(136&b){b+=7;continue}this._board[b]&&(a^=this._pieceKey(b))}return a^=this._epKey(),a^=this._castlingKey(),"b"===this._turn&&(a^=l),a}_updateSetup(a){this._history.length>0||(a!==m?(this._header.SetUp="1",this._header.FEN=a):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(m)}get(a){return this._board[s[a]]}findPiece(a){let b=[];for(let c=s.a8;c<=s.h1;c++){if(136&c){c+=7;continue}this._board[c]&&this._board[c]?.color===a.color&&this._board[c].color===a.color&&this._board[c].type===a.type&&b.push(D(c))}return b}put({type:a,color:b},c){return!!this._put({type:a,color:b},c)&&(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0)}_set(a,b){this._hash^=this._pieceKey(a),this._board[a]=b,this._hash^=this._pieceKey(a)}_put({type:a,color:b},c){if(-1==="pnbrqkPNBRQK".indexOf(a.toLowerCase())||!(c in s))return!1;let d=s[c];if("k"==a&&-1!=this._kings[b]&&this._kings[b]!=d)return!1;let e=this._board[d];return e&&"k"===e.type&&(this._kings[e.color]=-1),this._set(d,{type:a,color:b}),"k"===a&&(this._kings[b]=d),!0}_clear(a){this._hash^=this._pieceKey(a),delete this._board[a]}remove(a){let b=this.get(a);return this._clear(s[a]),b&&"k"===b.type&&(this._kings[b.color]=-1),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),b}_updateCastlingRights(){this._hash^=this._castlingKey();let a=this._board[s.e1]?.type==="k"&&this._board[s.e1]?.color==="w",b=this._board[s.e8]?.type==="k"&&this._board[s.e8]?.color==="b";a&&this._board[s.a1]?.type==="r"&&this._board[s.a1]?.color==="w"||(this._castling.w&=-65),a&&this._board[s.h1]?.type==="r"&&this._board[s.h1]?.color==="w"||(this._castling.w&=-33),b&&this._board[s.a8]?.type==="r"&&this._board[s.a8]?.color==="b"||(this._castling.b&=-65),b&&this._board[s.h8]?.type==="r"&&this._board[s.h8]?.color==="b"||(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){if(-1===this._epSquare)return;let a=this._epSquare+("w"===this._turn?-16:16),b=this._epSquare+("w"===this._turn?16:-16);if(null!==this._board[a]||null!==this._board[this._epSquare]||this._board[b]?.color!==E(this._turn)||this._board[b]?.type!=="p"){this._hash^=this._epKey(),this._epSquare=-1;return}[b+1,b-1].some(a=>!(136&a)&&this._board[a]?.color===this._turn&&this._board[a]?.type==="p")||(this._hash^=this._epKey(),this._epSquare=-1)}_attacked(a,b,c){let d=[];for(let e=s.a8;e<=s.h1;e++){if(136&e){e+=7;continue}if(void 0===this._board[e]||this._board[e].color!==a)continue;let f=this._board[e],g=e-b;if(0===g)continue;let h=g+119;if(v[h]&x[f.type]){if("p"===f.type){if(g>0&&"w"===f.color||g<=0&&"b"===f.color)if(!c)return!0;else d.push(D(e));continue}if("n"===f.type||"k"===f.type)if(!c)return!0;else{d.push(D(e));continue}let a=w[h],i=e+a,j=!1;for(;i!==b;){if(null!=this._board[i]){j=!0;break}i+=a}if(!j)if(!c)return!0;else{d.push(D(e));continue}}}return!!c&&d}attackers(a,b){return b?this._attacked(b,s[a],!0):this._attacked(this._turn,s[a],!0)}_isKingAttacked(a){let b=this._kings[a];return -1!==b&&this._attacked(E(a),b)}hash(){return this._hash.toString(16)}isAttacked(a,b){return this._attacked(b,s[a])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&0===this._moves().length}isStalemate(){return!this.isCheck()&&0===this._moves().length}isInsufficientMaterial(){let a={b:0,n:0,r:0,q:0,k:0,p:0},b=[],c=0,d=0;for(let e=s.a8;e<=s.h1;e++){if(d=(d+1)%2,136&e){e+=7;continue}let f=this._board[e];f&&(a[f.type]=f.type in a?a[f.type]+1:1,"b"===f.type&&b.push(d),c++)}if(2===c||3===c&&(1===a.b||1===a.n))return!0;if(c===a.b+2){let a=0,c=b.length;for(let d=0;d<c;d++)a+=b[d];if(0===a||a===c)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:a=!1,square:b,piece:c}={}){let d=this._moves({square:b,piece:c});return a?d.map(a=>new n(this,a)):d.map(a=>this._moveToSan(a,d))}_moves({legal:a=!0,piece:b,square:c}={}){let d=c?c.toLowerCase():void 0,e=b?.toLowerCase(),f=[],g=this._turn,h=E(g),i=s.a8,j=s.h1,k=!1;if(d)if(!(d in s))return[];else i=j=s[d],k=!0;for(let a=i;a<=j;a++){let b;if(136&a){a+=7;continue}if(!this._board[a]||this._board[a].color===h)continue;let{type:c}=this._board[a];if("p"===c){if(e&&e!==c)continue;b=a+t[g][0],!this._board[b]&&(F(f,g,a,b,"p"),b=a+t[g][1],B[g]!==a>>4||this._board[b]||F(f,g,a,b,"p",void 0,p.BIG_PAWN));for(let c=2;c<4;c++)136&(b=a+t[g][c])||(this._board[b]?.color===h?F(f,g,a,b,"p",this._board[b].type,p.CAPTURE):b===this._epSquare&&F(f,g,a,b,"p","p",p.EP_CAPTURE))}else{if(e&&e!==c)continue;for(let d=0,e=u[c].length;d<e;d++){let e=u[c][d];for(b=a;!(136&(b+=e));){if(this._board[b]){if(this._board[b].color===g)break;F(f,g,a,b,c,this._board[b].type,p.CAPTURE);break}if(F(f,g,a,b,c),"n"===c||"k"===c)break}}}}if((void 0===e||"k"===e)&&(!k||j===this._kings[g])){if(this._castling[g]&p.KSIDE_CASTLE){let a=this._kings[g],b=a+2;this._board[a+1]||this._board[b]||this._attacked(h,this._kings[g])||this._attacked(h,a+1)||this._attacked(h,b)||F(f,g,this._kings[g],b,"k",void 0,p.KSIDE_CASTLE)}if(this._castling[g]&p.QSIDE_CASTLE){let a=this._kings[g],b=a-2;this._board[a-1]||this._board[a-2]||this._board[a-3]||this._attacked(h,this._kings[g])||this._attacked(h,a-1)||this._attacked(h,b)||F(f,g,this._kings[g],b,"k",void 0,p.QSIDE_CASTLE)}}if(!a||-1===this._kings[g])return f;let l=[];for(let a=0,b=f.length;a<b;a++)this._makeMove(f[a]),this._isKingAttacked(g)||l.push(f[a]),this._undoMove();return l}move(a,{strict:b=!1}={}){let c=null;if("string"==typeof a)c=this._moveFromSan(a,b);else if(null===a)c=this._moveFromSan("--",b);else if("object"==typeof a){let b=this._moves();for(let d=0,e=b.length;d<e;d++)if(a.from===D(b[d].from)&&a.to===D(b[d].to)&&(!("promotion"in b[d])||a.promotion===b[d].promotion)){c=b[d];break}}if(!c)if("string"==typeof a)throw Error(`Invalid move: ${a}`);else throw Error(`Invalid move: ${JSON.stringify(a)}`);if(this.isCheck()&&c.flags&p.NULL_MOVE)throw Error("Null move not allowed when in check");let d=new n(this,c);return this._makeMove(c),this._incPositionCount(),d}_push(a){this._history.push({move:a,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(a,b){this._hash^=this._pieceKey(a),this._board[b]=this._board[a],delete this._board[a],this._hash^=this._pieceKey(b)}_makeMove(a){let b=this._turn,c=E(b);if(this._push(a),a.flags&p.NULL_MOVE){"b"===b&&this._moveNumber++,this._halfMoves++,this._turn=c,this._epSquare=-1;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),a.captured&&(this._hash^=this._pieceKey(a.to)),this._movePiece(a.from,a.to),a.flags&p.EP_CAPTURE&&("b"===this._turn?this._clear(a.to-16):this._clear(a.to+16)),a.promotion&&(this._clear(a.to),this._set(a.to,{type:a.promotion,color:b})),"k"===this._board[a.to].type){if(this._kings[b]=a.to,a.flags&p.KSIDE_CASTLE){let b=a.to-1,c=a.to+1;this._movePiece(c,b)}else if(a.flags&p.QSIDE_CASTLE){let b=a.to+1,c=a.to-2;this._movePiece(c,b)}this._castling[b]=0}if(this._castling[b]){for(let c=0,d=A[b].length;c<d;c++)if(a.from===A[b][c].square&&this._castling[b]&A[b][c].flag){this._castling[b]^=A[b][c].flag;break}}if(this._castling[c]){for(let b=0,d=A[c].length;b<d;b++)if(a.to===A[c][b].square&&this._castling[c]&A[c][b].flag){this._castling[c]^=A[c][b].flag;break}}if(this._hash^=this._castlingKey(),a.flags&p.BIG_PAWN){let d;d="b"===b?a.to-16:a.to+16,(a.to-1&136||this._board[a.to-1]?.type!=="p"||this._board[a.to-1]?.color!==c)&&(a.to+1&136||this._board[a.to+1]?.type!=="p"||this._board[a.to+1]?.color!==c)?this._epSquare=-1:(this._epSquare=d,this._hash^=this._epKey())}else this._epSquare=-1;"p"===a.piece||a.flags&(p.CAPTURE|p.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,"b"===b&&this._moveNumber++,this._turn=c,this._hash^=l}undo(){let a=this._hash,b=this._undoMove();if(b){let c=new n(this,b);return this._decPositionCount(a),c}return null}_undoMove(){let a=this._history.pop();if(void 0===a)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();let b=a.move;this._kings=a.kings,this._turn=a.turn,this._castling=a.castling,this._epSquare=a.epSquare,this._halfMoves=a.halfMoves,this._moveNumber=a.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=l;let c=this._turn,d=E(c);if(b.flags&p.NULL_MOVE)return b;if(this._movePiece(b.to,b.from),b.piece&&(this._clear(b.from),this._set(b.from,{type:b.piece,color:c})),b.captured)if(b.flags&p.EP_CAPTURE){let a;a="b"===c?b.to-16:b.to+16,this._set(a,{type:"p",color:d})}else this._set(b.to,{type:b.captured,color:d});if(b.flags&(p.KSIDE_CASTLE|p.QSIDE_CASTLE)){let a,c;b.flags&p.KSIDE_CASTLE?(a=b.to+1,c=b.to-1):(a=b.to-2,c=b.to+1),this._movePiece(c,a)}return b}pgn({newline:a="\n",maxWidth:b=0}={}){let c=[],d=!1;for(let b in this._header)this._header[b]&&c.push(`[${b} "${this._header[b]}"]`+a),d=!0;d&&this._history.length&&c.push(a);let e=a=>{let b=this._comments[this.fen()];if(void 0!==b){let c=a.length>0?" ":"";a=`${a}${c}{${b}}`}return a},f=[];for(;this._history.length>0;)f.push(this._undoMove());let g=[],h="";for(0===f.length&&g.push(e(""));f.length>0;){h=e(h);let a=f.pop();if(!a)break;if(this._history.length||"b"!==a.color)"w"===a.color&&(h.length&&g.push(h),h=this._moveNumber+".");else{let a=`${this._moveNumber}. ...`;h=h?`${h} ${a}`:a}h=h+" "+this._moveToSan(a,this._moves({legal:!0})),this._makeMove(a)}if(h.length&&g.push(e(h)),g.push(this._header.Result||"*"),0===b)return c.join("")+g.join(" ");let i=function(){return c.length>0&&" "===c[c.length-1]&&(c.pop(),!0)},j=0;for(let d=0;d<g.length;d++){if(j+g[d].length>b&&g[d].includes("{")){j=function(d,e){for(let f of e.split(" "))if(f){if(d+f.length>b){for(;i();)d--;c.push(a),d=0}c.push(f),d+=f.length,c.push(" "),d++}return i()&&d--,d}(j,g[d]);continue}j+g[d].length>b&&0!==d?(" "===c[c.length-1]&&c.pop(),c.push(a),j=0):0!==d&&(c.push(" "),j++),c.push(g[d]),j+=g[d].length}return c.join("")}header(...a){for(let b=0;b<a.length;b+=2)"string"==typeof a[b]&&"string"==typeof a[b+1]&&(this._header[a[b]]=a[b+1]);return this._header}setHeader(a,b){return this._header[a]=b??q[a]??null,this.getHeaders()}removeHeader(a){return a in this._header&&(this._header[a]=q[a]||null,!0)}getHeaders(){let a={};for(let[b,c]of Object.entries(this._header))null!==c&&(a[b]=c);return a}loadPgn(a,{strict:b=!1,newlineChar:c="\r?\n"}={}){"\r?\n"!==c&&(a=a.replace(RegExp(c,"g"),"\n"));let e=function(a,b){var c,e,f,g,h={},i=(b=void 0!==b?b:{}).grammarSource,j={pgn:ay},k=ay,l="O-O-O",m="0-0-0",n="1/2-1/2",o=/^[a-zA-Z]/,p=/^[^"]/,q=/^[0-9]/,r=/^[.]/,s=/^[a-zA-Z1-8\-=]/,t=/^[+#]/,u=/^[!?]/,v=/^[^}]/,w=/^[^\r\n]/,x=/^[ \t\r\n]/,y=au("tag pair"),z=as("[",!1),A=as('"',!1),B=as("]",!1),C=au("tag name"),D=at([["a","z"],["A","Z"]],!1,!1),E=au("tag value"),F=at(['"'],!0,!1),G=au("move number"),H=at([["0","9"]],!1,!1),I=as(".",!1),J=at(["."],!1,!1),K=au("standard algebraic notation"),L=as("O-O-O",!1),M=as("O-O",!1),N=as("0-0-0",!1),O=as("0-0",!1),P=at([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),Q=at(["+","#"],!1,!1),R=au("suffix annotation"),S=at(["!","?"],!1,!1),T=au("NAG"),U=as("$",!1),V=au("brace comment"),W=as("{",!1),X=at(["}"],!0,!1),Y=as("}",!1),Z=au("rest of line comment"),$=as(";",!1),_=at(["\r","\n"],!0,!1),aa=au("variation"),ab=as("(",!1),ac=as(")",!1),ad=au("game termination marker"),ae=as("1-0",!1),af=as("0-1",!1),ag=as("1/2-1/2",!1),ah=as("*",!1),ai=au("whitespace"),aj=at([" ","	","\r","\n"],!1,!1),ak=function(a,b){if(b.marker&&b.marker.comment){let a=b.root;for(;;){let c=a.variations[0];if(!c){a.comment=b.marker.comment;break}a=c}}return{headers:a,root:b.root,result:(b.marker&&b.marker.result)??void 0}},al=function(a,b){return function(...a){let[b,...c]=a,d=b;for(let a of c)null!==a&&(d.variations=[a,...a.variations],a.variations=[],d=a);return b}(null!==a?{comment:a,variations:[]}:{variations:[]},...b.flat())},am=function(a,b,c,d,e){let f={move:a,variations:e};return b&&(f.suffix=b),c&&(f.nag=c),null!==d&&(f.comment=d),f},an=0|b.peg$currPos,ao=[{line:1,column:1}],ap=an,aq=b.peg$maxFailExpected||[],ar=0|b.peg$silentFails;if(b.startRule){if(!(b.startRule in j))throw Error("Can't start parsing from rule \""+b.startRule+'".');k=j[b.startRule]}function as(a,b){return{type:"literal",text:a,ignoreCase:b}}function at(a,b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function au(a){return{type:"other",description:a}}function av(b){var c,d=ao[b];if(d)return d;if(b>=ao.length)c=ao.length-1;else for(c=b;!ao[--c];);for(d={line:(d=ao[c]).line,column:d.column};c<b;)10===a.charCodeAt(c)?(d.line++,d.column=1):d.column++,c++;return ao[b]=d,d}function aw(a,b,c){var d=av(a),e=av(b);return{source:i,start:{offset:a,line:d.line,column:d.column},end:{offset:b,line:e.line,column:e.column}}}function ax(a){an<ap||(an>ap&&(ap=an,aq=[]),aq.push(a))}function ay(){var b;return b=function(){var a,b;for(a=[],b=az();b!==h;)a.push(b),b=az();return b=aF(),Object.fromEntries(a)}(),ak(b,function(){var b,c,d,e,f;return b=aA(),aF(),(ar++,d=an,"1-0"===a.substr(an,3)?(e="1-0",an+=3):(e=h,0===ar&&ax(ae)),e===h&&("0-1"===a.substr(an,3)?(e="0-1",an+=3):(e=h,0===ar&&ax(af)),e===h&&(a.substr(an,7)===n?(e=n,an+=7):(e=h,0===ar&&ax(ag)),e===h&&(42===a.charCodeAt(an)?(e="*",an++):(e=h,0===ar&&ax(ah))))),e!==h)?(aF(),(f=aD())===h&&(f=null),d={result:e,comment:f}):(an=d,d=h),ar--,d===h&&(e=h,0===ar&&ax(ad)),(c=d)===h&&(c=null),aF(),{root:b,marker:c}}())}function az(){var b,c,d,e,f,g,i;return(ar++,b=an,aF(),91===a.charCodeAt(an)?(c="[",an++):(c=h,0===ar&&ax(z)),c!==h&&(aF(),(d=function(){var b,c,d;if(ar++,b=an,c=[],d=a.charAt(an),o.test(d)?an++:(d=h,0===ar&&ax(D)),d!==h)for(;d!==h;)c.push(d),d=a.charAt(an),o.test(d)?an++:(d=h,0===ar&&ax(D));else c=h;return b=c!==h?a.substring(b,an):c,ar--,b===h&&(c=h,0===ar&&ax(C)),b}())!==h&&(aF(),34===a.charCodeAt(an)?(e='"',an++):(e=h,0===ar&&ax(A)),e!==h&&(f=function(){var b,c,d;for(ar++,b=an,c=[],d=a.charAt(an),p.test(d)?an++:(d=h,0===ar&&ax(F));d!==h;)c.push(d),d=a.charAt(an),p.test(d)?an++:(d=h,0===ar&&ax(F));return b=a.substring(b,an),ar--,c=h,0===ar&&ax(E),b}(),34===a.charCodeAt(an)?(g='"',an++):(g=h,0===ar&&ax(A)),g!==h&&(aF(),93===a.charCodeAt(an)?(i="]",an++):(i=h,0===ar&&ax(B)),i!==h)))))?b=[d,f]:(an=b,b=h),ar--,b===h&&0===ar&&ax(y),b}function aA(){var a,b,c;for((a=aD())===h&&(a=null),b=[],c=aB();c!==h;)b.push(c),c=aB();return al(a,b)}function aB(){var b,c,d,e,f,g,i,j;if(b=an,aF(),function(){var b,c,d,e,f,g;for(ar++,b=an,c=[],d=a.charAt(an),q.test(d)?an++:(d=h,0===ar&&ax(H));d!==h;)c.push(d),d=a.charAt(an),q.test(d)?an++:(d=h,0===ar&&ax(H));if(46===a.charCodeAt(an)?(d=".",an++):(d=h,0===ar&&ax(I)),d!==h){for(e=aF(),f=[],g=a.charAt(an),r.test(g)?an++:(g=h,0===ar&&ax(J));g!==h;)f.push(g),g=a.charAt(an),r.test(g)?an++:(g=h,0===ar&&ax(J));b=c=[c,d,e,f]}else an=b,b=h;ar--,b===h&&(c=h,0===ar&&ax(G))}(),aF(),(c=function(){var b,c,d,e,f,g;if(ar++,b=an,c=an,a.substr(an,5)===l?(d=l,an+=5):(d=h,0===ar&&ax(L)),d===h&&("O-O"===a.substr(an,3)?(d="O-O",an+=3):(d=h,0===ar&&ax(M)),d===h&&(a.substr(an,5)===m?(d=m,an+=5):(d=h,0===ar&&ax(N)),d===h))&&("0-0"===a.substr(an,3)?(d="0-0",an+=3):(d=h,0===ar&&ax(O)),d===h))if(d=an,e=a.charAt(an),o.test(e)?an++:(e=h,0===ar&&ax(D)),e!==h){if(f=[],g=a.charAt(an),s.test(g)?an++:(g=h,0===ar&&ax(P)),g!==h)for(;g!==h;)f.push(g),g=a.charAt(an),s.test(g)?an++:(g=h,0===ar&&ax(P));else f=h;f!==h?d=e=[e,f]:(an=d,d=h)}else an=d,d=h;return d!==h?(e=a.charAt(an),t.test(e)?an++:(e=h,0===ar&&ax(Q)),e===h&&(e=null),c=d=[d,e]):(an=c,c=h),b=c!==h?a.substring(b,an):c,ar--,b===h&&(c=h,0===ar&&ax(K)),b}())!==h){for((d=function(){var b,c,d;for(ar++,b=an,c=[],d=a.charAt(an),u.test(d)?an++:(d=h,0===ar&&ax(S));d!==h;)c.push(d),c.length>=2?d=h:(d=a.charAt(an),u.test(d)?an++:(d=h,0===ar&&ax(S)));return c.length<1?(an=b,b=h):b=c,ar--,b===h&&(c=h,0===ar&&ax(R)),b}())===h&&(d=null),e=[],f=aC();f!==h;)e.push(f),f=aC();for(f=aF(),(g=aD())===h&&(g=null),i=[],j=aE();j!==h;)i.push(j),j=aE();b=am(c,d,e,g,i)}else an=b,b=h;return b}function aC(){var b,c,d,e,f;if(ar++,b=an,aF(),36===a.charCodeAt(an)?(c="$",an++):(c=h,0===ar&&ax(U)),c!==h){if(d=an,e=[],f=a.charAt(an),q.test(f)?an++:(f=h,0===ar&&ax(H)),f!==h)for(;f!==h;)e.push(f),f=a.charAt(an),q.test(f)?an++:(f=h,0===ar&&ax(H));else e=h;(d=e!==h?a.substring(d,an):e)!==h?b=d:(an=b,b=h)}else an=b,b=h;return ar--,b===h&&0===ar&&ax(T),b}function aD(){var b;return(b=function(){var b,c,d,e,f;if(ar++,b=an,123===a.charCodeAt(an)?(c="{",an++):(c=h,0===ar&&ax(W)),c!==h){for(d=an,e=[],f=a.charAt(an),v.test(f)?an++:(f=h,0===ar&&ax(X));f!==h;)e.push(f),f=a.charAt(an),v.test(f)?an++:(f=h,0===ar&&ax(X));(d=a.substring(d,an),125===a.charCodeAt(an)?(e="}",an++):(e=h,0===ar&&ax(Y)),e!==h)?b=d.replace(/[\r\n]+/g," "):(an=b,b=h)}else an=b,b=h;return ar--,b===h&&(c=h,0===ar&&ax(V)),b}())===h&&(b=function(){var b,c,d,e,f;if(ar++,b=an,59===a.charCodeAt(an)?(c=";",an++):(c=h,0===ar&&ax($)),c!==h){for(d=an,e=[],f=a.charAt(an),w.test(f)?an++:(f=h,0===ar&&ax(_));f!==h;)e.push(f),f=a.charAt(an),w.test(f)?an++:(f=h,0===ar&&ax(_));b=(d=a.substring(d,an)).trim()}else an=b,b=h;return ar--,b===h&&(c=h,0===ar&&ax(Z)),b}()),b}function aE(){var b,c,d,e;return(ar++,b=an,aF(),40===a.charCodeAt(an)?(c="(",an++):(c=h,0===ar&&ax(ab)),c!==h&&(d=aA())!==h&&(aF(),41===a.charCodeAt(an)?(e=")",an++):(e=h,0===ar&&ax(ac)),e!==h))?b=d:(an=b,b=h),ar--,b===h&&0===ar&&ax(aa),b}function aF(){var b,c;for(ar++,b=[],c=a.charAt(an),x.test(c)?an++:(c=h,0===ar&&ax(aj));c!==h;)b.push(c),c=a.charAt(an),x.test(c)?an++:(c=h,0===ar&&ax(aj));return ar--,c=h,0===ar&&ax(ai),b}if(g=k(),b.peg$library)return{peg$result:g,peg$currPos:an,peg$FAILED:h,peg$maxFailExpected:aq,peg$maxFailPos:ap};if(g!==h&&an===a.length)return g;throw g!==h&&an<a.length&&ax({type:"end"}),c=aq,e=ap<a.length?a.charAt(ap):null,f=ap<a.length?aw(ap,ap+1):aw(ap,ap),new d(d.buildMessage(c,e),c,e,f)}(a);this.reset();let f=e.headers,g="";for(let a in f)"fen"===a.toLowerCase()&&(g=f[a]),this.header(a,f[a]);if(b){if("1"===f.SetUp){if(!("FEN"in f))throw Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(f.FEN,{preserveHeaders:!0})}}else g&&this.load(g,{preserveHeaders:!0});let h=e.root;for(;h;){if(h.move){let a=this._moveFromSan(h.move,b);if(null==a)throw Error(`Invalid move in PGN: ${h.move}`);this._makeMove(a),this._incPositionCount()}void 0!==h.comment&&(this._comments[this.fen()]=h.comment),h=h.variations[0]}let i=e.result;i&&Object.keys(this._header).length&&this._header.Result!==i&&this.setHeader("Result",i)}_moveToSan(a,b){let c="";if(a.flags&p.KSIDE_CASTLE)c="O-O";else if(a.flags&p.QSIDE_CASTLE)c="O-O-O";else{if(a.flags&p.NULL_MOVE)return"--";if("p"!==a.piece){let d=function(a,b){let c=a.from,d=a.to,e=a.piece,f=0,g=0,h=0;for(let a=0,i=b.length;a<i;a++){let i=b[a].from,j=b[a].to;e===b[a].piece&&c!==i&&d===j&&(f++,c>>4==i>>4&&g++,(15&c)==(15&i)&&h++)}if(f>0)if(g>0&&h>0)return D(c);else if(h>0)return D(c).charAt(1);else return D(c).charAt(0);return""}(a,b);c+=a.piece.toUpperCase()+d}a.flags&(p.CAPTURE|p.EP_CAPTURE)&&("p"===a.piece&&(c+=D(a.from)[0]),c+="x"),c+=D(a.to),a.promotion&&(c+="="+a.promotion.toUpperCase())}return this._makeMove(a),this.isCheck()&&(this.isCheckmate()?c+="#":c+="+"),this._undoMove(),c}_moveFromSan(a,b=!1){let c,d,e,f,g,h=H(a);if(b||("0-0"===h?h="O-O":"0-0-0"===h&&(h="O-O-O")),"--"==h)return{color:this._turn,from:0,to:0,piece:"k",flags:p.NULL_MOVE};let i=G(h),j=this._moves({legal:!0,piece:i});for(let a=0,b=j.length;a<b;a++)if(h===H(this._moveToSan(j[a],j)))return j[a];if(b)return null;let k=!1;if((d=h.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/))?(c=d[1],e=d[2],f=d[3],g=d[4],1==e.length&&(k=!0)):(d=h.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/))&&(c=d[1],e=d[2],f=d[3],g=d[4],1==e.length&&(k=!0)),i=G(h),j=this._moves({legal:!0,piece:c||i}),!f)return null;for(let a=0,b=j.length;a<b;a++)if(e){if((!c||c.toLowerCase()==j[a].piece)&&s[e]==j[a].from&&s[f]==j[a].to&&(!g||g.toLowerCase()==j[a].promotion))return j[a];else if(k){let b=D(j[a].from);if((!c||c.toLowerCase()==j[a].piece)&&s[f]==j[a].to&&(e==b[0]||e==b[1])&&(!g||g.toLowerCase()==j[a].promotion))return j[a]}}else if(h===H(this._moveToSan(j[a],j)).replace("x",""))return j[a];return null}ascii(){let a="   +------------------------+\n";for(let b=s.a8;b<=s.h1;b++){if(0==(15&b)&&(a+=" "+"87654321"[b>>4]+" |"),this._board[b]){let c=this._board[b].type;a+=" "+("w"===this._board[b].color?c.toUpperCase():c.toLowerCase())+" "}else a+=" . ";b+1&136&&(a+="|\n",b+=8)}return a+"   +------------------------+\n     a  b  c  d  e  f  g  h"}perft(a){let b=this._moves({legal:!1}),c=0,d=this._turn;for(let e=0,f=b.length;e<f;e++)this._makeMove(b[e]),!this._isKingAttacked(d)&&(a-1>0?c+=this.perft(a-1):c++),this._undoMove();return c}setTurn(a){return this._turn!=a&&(this.move("--"),!0)}turn(){return this._turn}board(){let a=[],b=[];for(let c=s.a8;c<=s.h1;c++)null==this._board[c]?b.push(null):b.push({square:D(c),type:this._board[c].type,color:this._board[c].color}),c+1&136&&(a.push(b),b=[],c+=8);return a}squareColor(a){if(a in s){let b=s[a];return((b>>4)+(15&b))%2==0?"light":"dark"}return null}history({verbose:a=!1}={}){let b=[],c=[];for(;this._history.length>0;)b.push(this._undoMove());for(;;){let d=b.pop();if(!d)break;a?c.push(new n(this,d)):c.push(this._moveToSan(d,this._moves())),this._makeMove(d)}return c}_getPositionCount(a){return this._positionCount.get(a)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(a){let b=this._positionCount.get(a)??0;1===b?this._positionCount.delete(a):this._positionCount.set(a,b-1)}_pruneComments(){let a=[],b={},c=a=>{a in this._comments&&(b[a]=this._comments[a])};for(;this._history.length>0;)a.push(this._undoMove());for(c(this.fen());;){let b=a.pop();if(!b)break;this._makeMove(b),c(this.fen())}this._comments=b}getComment(){return this._comments[this.fen()]}setComment(a){this._comments[this.fen()]=a.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){let a=this._comments[this.fen()];return delete this._comments[this.fen()],a}getComments(){return this._pruneComments(),Object.keys(this._comments).map(a=>({fen:a,comment:this._comments[a]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(a=>{let b=this._comments[a];return delete this._comments[a],{fen:a,comment:b}})}setCastlingRights(a,b){for(let c of["k","q"])void 0!==b[c]&&(b[c]?this._castling[a]|=z[c]:this._castling[a]&=~z[c]);this._updateCastlingRights();let c=this.getCastlingRights(a);return(void 0===b.k||b.k===c.k)&&(void 0===b.q||b.q===c.q)}getCastlingRights(a){return{k:(this._castling[a]&z.k)!=0,q:(this._castling[a]&z.q)!=0}}moveNumber(){return this._moveNumber}}},48621:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(55648).A)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]])}};